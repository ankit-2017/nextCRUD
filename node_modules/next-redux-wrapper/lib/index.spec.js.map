{"version":3,"sources":["../src/index.spec.js"],"names":["appCtx","ctx","reducer","state","reduxStatus","action","type","payload","makeStore","initialState","SyncPage","props","store","JSON","stringify","getState","dispatch","custom","React","Component","someAsyncAction","Promise","res","AsyncPage","verifyComponent","WrappedPage","getInitialProps","expect","initialProps","toBe","component","renderer","create","tree","toJSON","toMatchSnapshot","test","describe","MyApp","serializeState","serialized","deserializeState","deserialized","toBeTruthy"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {applyMiddleware, createStore} from \"redux\";\nimport promiseMiddleware from \"redux-promise-middleware\";\nimport renderer from \"react-test-renderer\";\nimport withRedux from \"./index\";\n\nconst appCtx = {ctx: {}};\n\nconst reducer = (state = {reduxStatus: 'init'}, action) => {\n    switch (action.type) {\n        case 'FOO': // sync\n        case 'FOO_FULFILLED': // async\n            return {reduxStatus: action.payload};\n        default:\n            return state\n    }\n};\n\nconst makeStore = (initialState) => createStore(reducer, initialState, applyMiddleware(promiseMiddleware()));\n\nclass SyncPage extends React.Component {\n\n    static getInitialProps({ctx}) {\n        ctx.store.dispatch({type: 'FOO', payload: 'foo'});\n        return {custom: 'custom'};\n    }\n\n    render() {\n        const {store, ...props} = this.props;\n        return (\n            <div>\n                {JSON.stringify(props)}\n                {JSON.stringify(store.getState())}\n            </div>\n        )\n    }\n\n}\n\nconst someAsyncAction = ({\n    type: 'FOO',\n    payload: new Promise(res => res('foo'))\n});\n\nclass AsyncPage extends SyncPage {\n    static async getInitialProps({ctx}) {\n        await ctx.store.dispatch(someAsyncAction);\n        return {custom: 'custom'};\n    }\n}\n\nasync function verifyComponent(WrappedPage) {\n\n    // this is called by Next.js\n    const props = await WrappedPage.getInitialProps(appCtx);\n\n    expect(props.initialProps.custom).toBe('custom');\n    expect(props.initialState.reduxStatus).toBe('foo');\n\n    // this is called by Next.js\n    const component = renderer.create(<WrappedPage {...props}/>);\n\n    let tree = component.toJSON();\n    expect(tree).toMatchSnapshot();\n\n}\n\ntest('simple store integration', async () => {\n    const WrappedPage = withRedux(makeStore)(SyncPage);\n    await verifyComponent(WrappedPage);\n});\n\ntest('async store integration', async () => {\n    const WrappedPage = withRedux(makeStore)(AsyncPage);\n    await verifyComponent(WrappedPage);\n});\n\ndescribe('custom serialization', () => {\n    test('custom state serialization on the server and deserialization on the client', async () => {\n\n        class MyApp extends React.Component {\n            render(){\n                const {store} = this.props;\n                return (\n                    <div>{JSON.stringify(store.getState())}</div>\n                )\n            }\n        }\n\n        const WrappedPage = withRedux(makeStore, {\n            serializeState: state => ({ ...state, serialized: true }),\n            deserializeState: state => ({ ...state, deserialized: true })\n        })(MyApp);\n\n        const props = await WrappedPage.getInitialProps(appCtx);\n        expect(props.initialState.serialized).toBeTruthy();\n\n        // emulate client case\n        delete props.store;\n\n        // this is called by Next.js\n        const component = renderer.create(<WrappedPage {...props}/>);\n\n        let tree = component.toJSON();\n        expect(tree).toMatchSnapshot();\n\n    });\n});"],"file":"index.spec.js"}