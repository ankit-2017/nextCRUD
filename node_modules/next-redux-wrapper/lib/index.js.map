{"version":3,"sources":["../src/index.js"],"names":["_debug","DEFAULT_KEY","isServer","window","initStore","makeStore","initialState","config","ctx","storeKey","createStore","deserializeState","debug","serializeState","state","App","props","context","console","log","store","initialProps","Component","displayName","name","appCtx","Error","getState","getInitialProps","call"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\n\nlet _debug = false;\nconst DEFAULT_KEY = '__NEXT_REDUX_STORE__';\nconst isServer = typeof window === 'undefined';\n\n/**\n * @param makeStore\n * @param initialState\n * @param config\n * @param ctx\n * @return {{getState: function, dispatch: function}}\n */\nconst initStore = ({makeStore, initialState, config, ctx = {}}) => {\n\n    const {storeKey} = config;\n\n    const createStore = () => makeStore(\n        config.deserializeState(initialState),\n        {\n            ...ctx,\n            ...config,\n            isServer\n        }\n    );\n\n    if (isServer) return createStore();\n\n    // Memoize store if client\n    if (!window[storeKey]) {\n        window[storeKey] = createStore();\n    }\n\n    return window[storeKey];\n\n};\n\n/**\n * @param makeStore\n * @param config\n * @return {function(App): {getInitialProps, new(): WrappedApp, prototype: WrappedApp}}\n */\nexport default (makeStore, config = {}) => {\n\n    config = {\n        storeKey: DEFAULT_KEY,\n        debug: _debug,\n        serializeState: state => state,\n        deserializeState: state => state,\n        ...config\n    };\n\n    return (App) => (class WrappedApp extends Component {\n\n        static displayName = `withRedux(${App.displayName || App.name || 'App'})`;\n\n        static getInitialProps = async (appCtx) => {\n\n            if (!appCtx) throw new Error('No app context');\n            if (!appCtx.ctx) throw new Error('No page context');\n\n            const store = initStore({\n                makeStore,\n                config,\n                ctx: appCtx.ctx\n            });\n\n            if (config.debug) console.log('1. WrappedApp.getInitialProps wrapper got the store with state', store.getState());\n\n            appCtx.ctx.store = store;\n            appCtx.ctx.isServer = isServer;\n\n            let initialProps = {};\n\n            if ('getInitialProps' in App) {\n                initialProps = await App.getInitialProps.call(App, appCtx);\n            }\n\n            if (config.debug) console.log('3. WrappedApp.getInitialProps has store state', store.getState());\n\n            return {\n                isServer,\n                initialState: config.serializeState(store.getState()),\n                initialProps: initialProps\n            };\n\n        };\n\n        constructor(props, context) {\n\n            super(props, context);\n\n            const {initialState} = props;\n\n            if (config.debug) console.log('4. WrappedApp.render created new store with initialState', initialState);\n\n            this.store = initStore({\n                makeStore,\n                initialState,\n                config\n            });\n\n        }\n\n        render() {\n\n            let {initialProps, initialState, ...props} = this.props;\n\n            // Cmp render must return something like <Provider><Component/></Provider>\n            return (\n                <App {...props} {...initialProps} store={this.store}/>\n            );\n\n        }\n\n    });\n\n};"],"file":"index.js"}